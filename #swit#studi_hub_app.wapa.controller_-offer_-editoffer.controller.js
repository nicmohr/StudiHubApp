sap.ui.define(["Mosbach/StudiHub/controller/base.controller","sap/m/UploadCollectionParameter","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,i,s){"use strict";return e.extend("Mosbach.StudiHub.controller.Offer.EditOffer",{extendInit:function(){th+
is.oRouter.getRoute("RouteEditOffer").attachPatternMatched(this._onObjectMatched,this)},onLiveChange:function(){var e=this.byId("inputShortHeader").getValue();var t=this.byId("inputCompany").getValue();var i=this.byId("selectIcon").getSelectedKey();var s+
=this.byId("inputNumber").getValue();if(this.byId("dateRange").getSecondDateValue()){var n="Bis: "+this.dateFormatter(this.byId("dateRange").getSecondDateValue())}this.generateOfferTile(e,t,i,s,n)},_onObjectMatched:function(e){var t=this;this.postId=e.ge+
tParameter("arguments").ID;this.byId("UploadCollection").removeAllItems();this.oModel.read("/OfferSet('"+this.postId.substr(1)+"')",{success:function(e){if(e.Pdfsource){t.byId("UploadCollection").addItem(new sap.m.UploadCollectionItem({fileName:"DATEI"})+
)}}});this.getView().bindElement("/OfferSet('"+this.postId.substr(1)+"')");setTimeout(function(e,i){t.onLiveChange()},1500);this.xBinary=""},pressNavBack:function(){this.oRouter.navTo("RouteDetailOffer",{ID:this.postId})},generateOfferTile:function(e,t,i+
,s,n){var a=new sap.m.GenericTile;var o=new sap.m.TileContent;var r=this.getTileContent(s,i);a.setHeader(e);a.setSubheader(t);a.setMode();a.addStyleClass("sapUiTinyMargin");a.addStyleClass("sapUiTinyMargin");o.setFooter(n);o.setContent(r);a.addTileConten+
t(o);this.byId("flexBoxPreview").destroyItems();this.byId("flexBoxPreview").addItem(a)},getTileContent:function(e,t){var i;if(e){i=new sap.m.NumericContent;i.setValue(e);i.setIcon(t);i.setWithMargin(false)}else{i=new sap.m.ImageContent;i.setSrc(t)}return+
 i},onSavePress:function(){var e=this.getOffer();if(this.fieldsValid(e)){this.updateOffer(e)}},onDeletePress:function(){var e=this.getOffer();var t=this;s.warning("Wollen Sie wirklich das Angebot: '"+e.Title+"' löschen?",{actions:["Löschen",s.Action.CLOS+
E],emphasizedAction:"Löschen",onClose:function(e){if(e=="Löschen"){t.oModel.remove("/OfferSet('"+t.postId.substr(1)+"')",{success:function(){i.show("Angebot erfolgreich gelöscht!");setTimeout(function(){t.navToMaster()},1500)},error:function(){i.show("Fe+
hler beim Löschen des Angebots!")}})}else{}}})},getOffer:function(){return{Postid:this.getView().getBindingContext().getObject().Postid,Userid:this.getView().getBindingContext().getObject().Userid,Begda:this.removeTimeZoneOffset(this.byId("dateRange").ge+
tDateValue()),Endda:this.removeTimeZoneOffset(this.byId("dateRange").getSecondDateValue()),Title:this.byId("inputHeader").getValue(),ShortTitle:this.byId("inputShortHeader").getValue(),OfferValue:this.byId("inputNumber").getValue(),Icon:this.byId("select+
Icon").getSelectedKey(),Street:this.byId("inputStreet").getValue(),City:this.byId("inputCity").getValue(),Postcode:this.byId("inputPostcode").getValue(),Descr:this.byId("textArea").getValue(),Weblink:this.byId("inputWebsite").getValue(),Pdfsource:this.ge+
tView().getBindingContext().getObject().Pdfsource,Pdfbinary:this.xBinary,Uname:""}},fieldsValid:function(e){var t=false;if(!e.Title){this.byId("inputHeader").setValueState("Error");t=true}else{this.byId("inputHeader").setValueState("None")}if(!e.ShortTit+
le){this.byId("inputShortHeader").setValueState("Error");t=true}else{this.byId("inputShortHeader").setValueState("None")}if(!e.Begda||!e.Endda){this.byId("dateRange").setValueState("Error");t=true}else{this.byId("dateRange").setValueState("None")}if(!e.D+
escr){this.byId("textArea").setValueState("Error");t=true}else{this.byId("textArea").setValueState("None")}if(t){i.show("Bitte fülle alle Pflichtfelder aus!")}return!t},updateOffer:function(e){var t=this;if(this.byId("UploadCollection").getItems().length+
===0){e.Pdfsource=""}this.oModel.update("/OfferSet('"+this.postId.substr(1)+"')",e,{success:function(e,s){i.show("Angebot erfolgreich angelegt!");setTimeout(function(){t.oRouter.navTo("RouteDetailOffer",{ID:t.postId})},1500)},error:function(){i.show("Feh+
ler beim Speichern des Angebots!")}})},onFileSelected:function(e){var i=e.getSource();i.removeAllItems();var s=new t({name:"x-csrf-token",value:this.oModel.getSecurityToken()});i.addHeaderParameter(s);this.saveFileTemporary(e.getParameter("files")[0])},s+
aveFileTemporary:function(e){var t;var i=new FileReader;var s=this;i.onload=function(e){var i=e.target.result;var n;if(btoa(i)){n=btoa(i)}else{n=btoa(encodeURIComponent(i))}if(typeof base64file==="undefined"||typeof base64file===null){t=n}else{t=t+"new"++
n}s.xBinary=t};i.readAsBinaryString(e)}})});                                                                                                                                                                                                                   
sap.ui.define(["Mosbach/StudiHub/controller/base.controller","sap/m/UploadCollectionParameter","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,i,a){"use strict";return e.extend("Mosbach.StudiHub.controller.Job.EditJob",{extendInit:function(){this.o+
Router.getRoute("RouteEditJob").attachPatternMatched(this._onObjectMatched,this);this.onLiveChange()},_onObjectMatched:function(e){var t=this;this.xBinary="";this.postId=e.getParameter("arguments").ID;this.byId("UploadCollection").removeAllItems();this.o+
Model.read("/JobSet('"+this.postId.substr(1)+"')",{success:function(e){if(e.Pdfsource){t.byId("UploadCollection").addItem(new sap.m.UploadCollectionItem({fileName:"DATEI"}))}}});this.getView().bindElement("/JobSet('"+this.postId.substr(1)+"')");setTimeou+
t(function(e,i){t.onLiveChange()},1500);this.xBinary=""},pressNavBack:function(){this.oRouter.navTo("RouteDetailJob",{ID:this.postId})},onLiveChange:function(){var e=this.byId("inputShortHeader").getValue();var t=this.byId("inputCompany").getValue();var +
i=this.byId("inputNumber").getValue()+"/Std";if(this.byId("dateRange").getSecondDateValue()){var a="Bis: "+this.dateFormatter(this.byId("dateRange").getSecondDateValue())}this.generateJobTile(e,t,i,a)},generateJobTile:function(e,t,i,a){var s=new sap.m.Ge+
nericTile;var o=new sap.m.TileContent;var n=new sap.m.NumericContent;s.setHeader(e);s.setSubheader(t);s.addStyleClass("sapUiTinyMarginBegin");s.addStyleClass("sapUiTinyMarginTop");s.addStyleClass("tileLayout");o.setFooter(a);n.setValue(i);o.setContent(n)+
;s.addTileContent(o);this.byId("flexBoxPreview").destroyItems();this.byId("flexBoxPreview").addItem(s)},onDeletePress:function(){var e=this.getJob();var t=this;a.warning("Wollen Sie wirklich den Minijob: '"+e.Title+"' löschen?",{actions:["Löschen",a.Acti+
on.CLOSE],emphasizedAction:"Löschen",onClose:function(e){if(e=="Löschen"){t.oModel.remove("/JobSet('"+t.postId.substr(1)+"')",{success:function(){i.show("Minijob erfolgreich gelöscht!");setTimeout(function(){t.navToMaster()},1500)},error:function(){i.sho+
w("Fehler beim Löschen des Minijobs!")}})}else{}}})},onSavePress:function(){var e=this.getJob();if(this.fieldsValid(e)){this.saveJob(e)}},fieldsValid:function(e){var t=false;if(!e.Title){this.byId("inputHeader").setValueState("Error");t=true}else{this.by+
Id("inputHeader").setValueState("None")}if(!e.ShortTitle){this.byId("inputShortHeader").setValueState("Error");t=true}else{this.byId("inputShortHeader").setValueState("None")}if(!e.Begda||!e.Endda){this.byId("dateRange").setValueState("Error");t=true}els+
e{this.byId("dateRange").setValueState("None")}if(!e.Descr){this.byId("textArea").setValueState("Error");t=true}else{this.byId("textArea").setValueState("None")}if(t){i.show("Bitte fülle alle Pflichtfelder aus!")}return!t},getJob:function(){var e={Postid+
:this.getView().getBindingContext().getObject().Postid,Userid:this.getView().getBindingContext().getObject().Userid,Begda:this.removeTimeZoneOffset(this.byId("dateRange").getDateValue()),Endda:this.removeTimeZoneOffset(this.byId("dateRange").getSecondDat+
eValue()),Title:this.byId("inputHeader").getValue(),ShortTitle:this.byId("inputShortHeader").getValue(),Wage:this.byId("inputNumber").getValue()+"",Street:this.byId("inputStreet").getValue(),City:this.byId("inputCity").getValue(),Postcode:this.byId("inpu+
tPostcode").getValue(),Descr:this.byId("textArea").getValue(),Weblink:this.byId("inputWebsite").getValue(),Pdfsource:this.getView().getBindingContext().getObject().Pdfsource,Pdfbinary:this.xBinary,Uname:""};if(!e.Wage)e.Wage="0";return e},saveJob:functio+
n(e){var t=this;var a;if(this.byId("UploadCollection").getItems().length===0){e.Pdfsource=""}this.oModel.update("/JobSet('"+e.Postid+"')",e,{success:function(s,o){i.show("Minijob erfolgreich angelegt!");a=e.Postid;setTimeout(function(){t.oRouter.navTo("R+
outeDetailJob",{ID:"J"+a})},1500)},error:function(){i.show("Fehler beim Speichern des Minijobs!")}})},onFileSelected:function(e){var i=e.getSource();i.removeAllItems();var a=new t({name:"x-csrf-token",value:this.oModel.getSecurityToken()});i.addHeaderPar+
ameter(a);this.saveFileTemporary(e.getParameter("files")[0])},saveFileTemporary:function(e){var t;var i=new FileReader;var a=this;i.onload=function(e){var i=e.target.result;var s;if(btoa(i)){s=btoa(i)}else{s=btoa(encodeURIComponent(i))}if(typeof base64fi+
le==="undefined"||typeof base64file===null){t=s}else{t=t+"new"+s}a.xBinary=t};i.readAsBinaryString(e)}})});                                                                                                                                                    
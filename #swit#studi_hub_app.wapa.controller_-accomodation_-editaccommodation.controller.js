sap.ui.define(["Mosbach/StudiHub/controller/base.controller","sap/m/UploadCollectionParameter","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,i,s){"use strict";return e.extend("Mosbach.StudiHub.controller.Accomodation.EditAccommodation",{extendIni+
t:function(){this.oRouter.getRoute("RouteEditAccommodation").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){var t=this;this.xBinary="";this.postId=e.getParameter("arguments").ID;this.byId("UploadCollection").removeAllItems+
();this.oModel.read("/AccomSet('"+this.postId.substr(1)+"')",{success:function(e){if(e.Pdfsource){t.byId("UploadCollection").addItem(new sap.m.UploadCollectionItem({fileName:"DATEI"}))}}});this.getView().bindElement("/AccomSet('"+this.postId.substr(1)+"'+
)");setTimeout(function(e,i){t.onLiveChange()},1500)},pressNavBack:function(){this.oRouter.navTo("RouteDetailAccommodation",{ID:this.postId})},onLiveChange:function(e){var t=this.byId("inputHeader").getValue();var i=this.byId("inputStreet").getValue();va+
r s=this.byId("inputRooms").getValue()+" Zimmer "+this.byId("inputNumber").getValue()+"qm";var a=this.byId("inputPrice").getValue();if(this.byId("dateRange").getSecondDateValue()){var o="Bis: "+this.dateFormatter(this.byId("dateRange").getSecondDateValue+
())}this.generateAccommodationTile(t,i,s,a,o)},generateAccommodationTile:function(e,t,i,s,a){var o=new sap.m.GenericTile;var n=new sap.m.TileContent;var r=new sap.m.FeedContent;o.addStyleClass("sapUiTinyMarginBegin");o.addStyleClass("sapUiTinyMarginTop")+
;o.setFrameType("TwoByOne");o.setHeader(e);n.setFooter(a);r.setValue(s);r.setSubheader(i);r.setContentText(t);n.setContent(r);o.addTileContent(n);this.byId("flexBoxPreview").destroyItems();this.byId("flexBoxPreview").addItem(o)},getAccom:function(){retur+
n{Postid:this.getView().getBindingContext().getObject().Postid,Userid:this.getView().getBindingContext().getObject().Userid,Begda:this.removeTimeZoneOffset(this.byId("dateRange").getDateValue()),Endda:this.removeTimeZoneOffset(this.byId("dateRange").getS+
econdDateValue()),Title:this.byId("inputHeader").getValue(),Cost:this.byId("inputPrice").getValue(),Rooms:this.byId("inputRooms").getValue()+"",Area:this.byId("inputNumber").getValue(),Street:this.byId("inputStreet").getValue(),City:this.byId("inputCity"+
).getValue(),Postcode:this.byId("inputPostcode").getValue(),Descr:this.byId("textArea").getValue(),Weblink:this.byId("inputWebsite").getValue(),Pdfbinary:this.xBinary,Pdfsource:"",Uname:""}},onSavePress:function(){var e=this.getAccom();if(this.fieldsVali+
d(e)){this.saveAccom(e)}},fieldsValid:function(e){var t=false;if(!e.Title){this.byId("inputHeader").setValueState("Error");t=true}else{this.byId("inputHeader").setValueState("None")}if(!e.Street){this.byId("inputStreet").setValueState("Error");t=true}els+
e{this.byId("inputStreet").setValueState("None")}if(!e.Postcode){this.byId("inputPostcode").setValueState("Error");t=true}else{this.byId("inputPostcode").setValueState("None")}if(!e.City){this.byId("inputCity").setValueState("Error");t=true}else{this.byI+
d("inputCity").setValueState("None")}if(!e.Rooms){this.byId("inputRooms").setValueState("Error");t=true}else{this.byId("inputRooms").setValueState("None")}if(!e.Cost){this.byId("inputPrice").setValueState("Error");t=true}else{this.byId("inputPrice").setV+
alueState("None")}if(!e.Area){this.byId("inputNumber").setValueState("Error");t=true}else{this.byId("inputNumber").setValueState("None")}if(!e.Begda||!e.Endda){this.byId("dateRange").setValueState("Error");t=true}else{this.byId("dateRange").setValueState+
("None")}if(!e.Descr){this.byId("textArea").setValueState("Error");t=true}else{this.byId("textArea").setValueState("None")}if(t){i.show("Bitte fülle alle Pflichtfelder aus!")}return!t},onDeletePress:function(){var e=this.getAccom();var t=this;s.warning("+
Wollen Sie wirklich das Inserat: '"+e.Title+"' löschen?",{actions:["Löschen",s.Action.CLOSE],emphasizedAction:"Löschen",onClose:function(e){if(e=="Löschen"){t.oModel.remove("/AccomSet('"+t.postId.substr(1)+"')",{success:function(){i.show("Inserat erfolgr+
eich gelöscht!");setTimeout(function(){t.navToMaster()},1500)},error:function(){i.show("Fehler beim Löschen des Inserats!")}})}else{}}})},saveAccom:function(e){var t=this;var s;if(this.byId("UploadCollection").getItems().length===0){e.Pdfsource=""}this.o+
Model.update("/AccomSet('"+e.Postid+"')",e,{success:function(a,o){i.show("Inserat erfolgreich angelegt!");s=e.Postid;setTimeout(function(){t.oRouter.navTo("RouteDetailAccommodation",{ID:"A"+s})},1500)},error:function(){i.show("Fehler beim Speichern des I+
nserats!")}})},onFileSelected:function(e){var i=e.getSource();i.removeAllItems();var s=new t({name:"x-csrf-token",value:this.oModel.getSecurityToken()});i.addHeaderParameter(s);this.saveFileTemporary(e.getParameter("files")[0])},saveFileTemporary:functio+
n(e){var t;var i=new FileReader;var s=this;i.onload=function(e){var i=e.target.result;var a;if(btoa(i)){a=btoa(i)}else{a=btoa(encodeURIComponent(i))}if(typeof base64file==="undefined"||typeof base64file===null){t=a}else{t=t+"new"+a}s.xBinary=t};i.readAsB+
inaryString(e)}})});                                                                                                                                                                                                                                           
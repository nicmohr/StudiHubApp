sap.ui.define(["Mosbach/StudiHub/controller/base.controller","sap/m/UploadCollectionParameter","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,i,n){"use strict";return e.extend("Mosbach.StudiHub.controller.Event.EditEvent",{extendInit:function(){th+
is.oRouter.getRoute("RouteEditEvent").attachPatternMatched(this._onObjectMatched,this);this.onLiveChange()},_onObjectMatched:function(e){var t=this;this.xBinary="";this.postId=e.getParameter("arguments").ID;this.byId("UploadCollection").removeAllItems();+
this.oModel.read("/EventSet('"+this.postId.substr(1)+"')",{success:function(e){if(e.Pdfsource){t.byId("UploadCollection").addItem(new sap.m.UploadCollectionItem({fileName:"DATEI"}))}}});this.getView().bindElement("/EventSet('"+this.postId.substr(1)+"')")+
;setTimeout(function(e,i){t.onLiveChange()},1500);this.xBinary=""},pressNavBack:function(){this.oRouter.navTo("RouteDetailEvent",{ID:this.postId})},onLiveChange:function(){var e=this.byId("inputHeader").getValue();var t=this.byId("inputCompany").getValue+
();if(this.byId("dateRange").getSecondDateValue()){var i="Bis: "+this.dateFormatter(this.byId("dateRange").getSecondDateValue())}this.generateEventTile(e,t,i)},generateEventTile:function(e,t,i){var n=new sap.m.GenericTile;var s=new sap.m.TileContent;n.ad+
dStyleClass("sapUiTinyMarginBegin");n.addStyleClass("sapUiTinyMarginTop");n.setFrameType("OneByOne");n.setHeader(e);n.setSubheader(t);n.setMode("HeaderMode");s.setFooter(i);n.addTileContent(s);this.byId("flexBoxPreview").destroyItems();this.byId("flexBox+
Preview").addItem(n)},getEvent:function(){return{Postid:this.getView().getBindingContext().getObject().Postid,Userid:this.getView().getBindingContext().getObject().Userid,Begda:this.removeTimeZoneOffset(this.byId("dateRange").getDateValue()),Endda:this.r+
emoveTimeZoneOffset(this.byId("dateRange").getSecondDateValue()),Title:this.byId("inputHeader").getValue(),Street:this.byId("inputStreet").getValue(),City:this.byId("inputCity").getValue(),Postcode:this.byId("inputPostcode").getValue(),Descr:this.byId("t+
extArea").getValue(),Weblink:this.byId("inputWebsite").getValue(),Uname:"",Pdfsource:this.getView().getBindingContext().getObject().Pdfsource,Pdfbinary:this.xBinary}},onSavePress:function(){var e=this.getEvent();if(this.fieldsValid(e)){this.updateEvent(e+
)}},onDeletePress:function(){var e=this.getEvent();var t=this;n.warning("Wollen Sie wirklich das Event: '"+e.Title+"' löschen?",{actions:["Löschen",n.Action.CLOSE],emphasizedAction:"Löschen",onClose:function(e){if(e=="Löschen"){t.oModel.remove("/EventSet+
('"+t.postId.substr(1)+"')",{success:function(){i.show("Event erfolgreich gelöscht!");setTimeout(function(){t.navToMaster()},1500)},error:function(){i.show("Fehler beim Löschen des Events!")}})}else{}}})},fieldsValid:function(e){var t=false;if(!e.Title){+
this.byId("inputHeader").setValueState("Error");t=true}else{this.byId("inputHeader").setValueState("None")}if(!e.Begda||!e.Endda){this.byId("dateRange").setValueState("Error");t=true}else{this.byId("dateRange").setValueState("None")}if(!e.Descr){this.byI+
d("textArea").setValueState("Error");t=true}else{this.byId("textArea").setValueState("None")}if(t){i.show("Bitte fülle alle Pflichtfelder aus!")}return!t},updateEvent:function(e){var t=this;if(this.byId("UploadCollection").getItems().length===0){e.Pdfsou+
rce=""}this.oModel.update("/EventSet('"+this.postId.substr(1)+"')",e,{success:function(e,n){i.show("Event erfolgreich angelegt!");setTimeout(function(){t.oRouter.navTo("RouteDetailEvent",{ID:t.postId})},1500)},error:function(){i.show("Fehler beim Speiche+
rn des Events!")}})},onFileSelected:function(e){var i=e.getSource();i.removeAllItems();var n=new t({name:"x-csrf-token",value:this.oModel.getSecurityToken()});i.addHeaderParameter(n);this.saveFileTemporary(e.getParameter("files")[0])},saveFileTemporary:f+
unction(e){var t;var i=new FileReader;var n=this;i.onload=function(e){var i=e.target.result;var s;if(btoa(i)){s=btoa(i)}else{s=btoa(encodeURIComponent(i))}if(typeof base64file==="undefined"||typeof base64file===null){t=s}else{t=t+"new"+s}n.xBinary=t};i.r+
eadAsBinaryString(e)}})});                                                                                                                                                                                                                                     